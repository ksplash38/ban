Ext.define("IFS.view.container.PhoneWidget",{extend:"Ext.container.Container",alias:"widget.phone",baseCls:"ifs-phone-widget",invalidCls:this.baseCls+"-invalid",inputConfig:{},config:{commonId:"",isInternationalPhoneEnabled:false,phoneMinLength:9,phoneMaxLength:16,staticResourceContext:"",countryStore:[],inputWidth:200,phoneNumber:"",selectedCountryCode:"",disableWidget:false,isPhoneValid:true,hideDropdown:true,phoneRequired:false},initComponent:function(){var a=this;var b=/[0-9()-+]/i;Ext.apply(Ext.form.field.VTypes,{phone:function(c){return b.test(c)},phoneMask:/[0-9()-+]/i});if(!this.isInternationalPhoneEnabled){this.countryStore=[{countryName:"USA",countryCode:"1"}]}countryCodes=Ext.create("Ext.data.Store",{fields:["countryName","countryCode"],data:this.countryStore});a.stripSpecialCharacters=function(c){c=c.replace(/[^0-9]/g,"");return c};Ext.apply(a,{items:[{xtype:"container",baseCls:this.baseCls+"-container",disabled:this.disableWidget,disabledCls:this.baseCls+"-container-disabled",items:[a.dropdown=Ext.create("IFS.view.form.Dropdown",{id:a.commonId+"Dropdown",cls:this.baseCls+"-dropdown",componentCls:this.baseCls+"-dropdown",emptyText:"+1",store:countryCodes,value:"1",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item"  role="listitem" aria-label="{countryName} +{countryCode}"><div class="new-flag new-flag-',"{[this.generateFlagCss(values.countryName)]}",'"></div>','<div class="ifs-phone-widget-dropdown-country">{countryName}</div><div class="ifs-phone-widget-dropdown-countrycode">+{countryCode}</div></div>',"</tpl>",{generateFlagCss:function(c){return Ext.String.splitWords(c).join("_")}}),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"+{countryCode}","</tpl>"),displayField:"countryCode",valueField:"countryCode",queryMode:"local",disabled:this.disableWidget,disabledCls:"ifs-phone-widget-dropdown-disabled",arialabelText:true,editable:false,isComboboxOpenAlert:true,ariaComboAjaxList:true,ariaAddressCombo:true,enableKeyEvents:true,matchFieldWidth:false,growToLongestValue:true,pickerOffset:[-12,6],listConfig:{disabled:!this.isInternationalPhoneEnabled,disableSelection:!this.isInternationalPhoneEnabled,disabledCls:"x-hide-display",selectedItemCls:"ifs-phone-widget-dropdown-selected",cls:this.baseCls+"-dropdown",componentCls:this.baseCls+"-dropdown",overflowX:"hidden",listeners:{highlightitem:function(c,d){Ext.get(d).addCls("ifs-phone-widget-dropdown-item-hover")},unhighlightitem:function(c,d){Ext.get(d).removeCls("ifs-phone-widget-dropdown-item-hover")}}},listeners:{afterrender:function(){if(a.isInternationalPhoneEnabled){a.dropdown.enable()}else{a.dropdown.disable()}},select:function(){a.parsePhoneNumber(a.phoneField.getValue());a.checkPhoneValidity(a.dropdown.getValue(),a.phoneField.getValue())},change:function(f,e){a.hideErrorMessage();if(!Ext.isEmpty(e)){var c=e.length;var d=60+(c-1)*10;Ext.select("#"+a.commonId+"Dropdown.x-form-item.ifs-dropdown-default.x-autocontainer-form-item").setStyle("width",d+"px");ARIA.setProperty(a.dropdown.inputEl,"aria-label","+"+e)}},keyup:function(h,g){var f=String.fromCharCode(g.getKey()),e=h.getPicker(),d=e.getStore(),c=d.findRecord("countryName",f);if(c){e.highlightItem(e.getNode(c));e.listEl.scrollChildIntoView(e.getNode(c),false)}}}}),a.phoneField=Ext.create("Ext.form.field.Text",{cls:this.baseCls+"-text",fieldCls:this.baseCls+"-form-field",emptyText:"(xxx) xxx-xxxx",vtype:"phone",id:"phoneNumber-"+a.commonId,columnWidth:this.inputWidth,shadow:false,preventMark:true,disabled:this.disableWidget,disabledCls:"ifs-phone-widget-text-disabled",validateOnChange:false,enableKeyEvents:true,listeners:{blur:function(){var c=a.phoneField.getValue();if(!a.hideDropdown){a.parsePhoneNumber(c)}a.checkPhoneValidity(a.dropdown.getValue(),a.phoneNumber)},change:function(){a.hideErrorMessage()}}})]},a.errorDiv=Ext.create("Ext.container.Container",{cls:this.baseCls+"-error-div",id:a.commonId+"Error",items:[{xtype:"image",cls:this.baseCls+"-error-image",src:this.staticResourceContext+"/static/images/icon-error-small.png"},a.errorText=Ext.create("Ext.container.Container",{id:a.commonId+"ErrorMsg",cls:this.baseCls+"-error-text"})]})]});a.errorDiv.hide();if(a.hideDropdown){a.dropdown.hide()}a.setPhoneNumber=function(c,d){if(!a.hideDropdown){a.dropdown.select(c)}a.phoneField.setValue(a.formatPhoneNumber(c,d))};a.renderPhoneNumber=function(c,d){a.setPhoneNumber(c,d);if(!a.isInternationalPhoneEnabled&&c!="1"){a.addCls(a.baseCls+"-disable");a.dropdown.disable();a.phoneField.disable()}else{a.checkPhoneValidity(c,d)}};a.showErrorMessage=function(c){a.errorDiv.show();a.errorText.update(c);a.phoneField.inputEl.dom.setAttribute("aria-invalid","true");a.isPhoneValid=false;a.addCls(a.baseCls+"-invalid");ARIA.setAlertMessage(c)};a.hideErrorMessage=function(){a.errorText.update("");a.errorDiv.hide();a.phoneField.inputEl.dom.setAttribute("aria-invalid","false");a.isPhoneValid=true;a.removeCls(a.baseCls+"-invalid")};a.formatPhoneNumber=function(c,d){var e=this;if(d==null){return""}d=e.stripSpecialCharacters(d);if((c=="1"||e.hideDropdown)&&d.length==10){return"("+d.substring(0,3)+") "+d.substring(3,6)+"-"+d.substring(6,10)}return d};a.resetWidget=function(){var c=this;c.phoneNumber="";Ext.getDom(c.phoneField.inputId).value="";Ext.get(c.commonId+"Error").hide();c.checkAndSetPhoneNumber("1",c.phoneNumber)},a.checkPhoneValidity=function(c,f){var g=this;c=(Ext.isEmpty(c))?(Ext.isEmpty(g.getCountryCode())?"1":g.getCountryCode()):c;f=(Ext.isEmpty(f))?((g.phoneField.getValue().indexOf("+")==0)?"+"+g.getPhoneNumber():g.getPhoneNumber()):f;var e=null;if(Ext.isEmpty(f)){if(g.phoneRequired){e=ifs.env.i18nStrings.phoneWidget.common.fieldError}}else{if(f.indexOf("+")==0){if(g.isInternationalPhoneEnabled){e=ifs.env.i18nStrings.phoneWidget.common.unrecognizedCountryCode}else{e=(g.hideDropdown)?ifs.env.i18nStrings.phoneWidget.common.invalidUsNumber:ifs.env.i18nStrings.phoneWidget.common.invalidNumber}}else{if(c=="1"){f=g.stripSpecialCharacters(f);if(f.length<10){e=ifs.env.i18nStrings.phoneWidget.common.tooShort}else{if(f.length>10){e=ifs.env.i18nStrings.phoneWidget.common.tooLong}else{g.phoneField.setValue(g.formatPhoneNumber(c,f))}}}else{if(c!="1"){f=g.stripSpecialCharacters(f);if((c.length+f.length)<g.phoneMinLength){e=ifs.env.i18nStrings.phoneWidget.common.tooShort}else{if((c.length+f.length)>g.phoneMaxLength){e=ifs.env.i18nStrings.phoneWidget.common.tooLong}}}}}}var d=!e;if(!d){g.showErrorMessage(e)}else{g.hideErrorMessage()}return d};a.parsePhoneNumber=function(e){var j=this;var h=j.stripSpecialCharacters(e);var c;if(e.indexOf("+")==0){var d=false;var k=5;if(!this.isInternationalPhoneEnabled){k=1}for(var f=k;f>0;f--){var g=h.substring(0,f);if(j.dropdown.findRecordByValue(g)){j.setPhoneNumber(g,h.substring(g.length,h.length));j.phoneNumber=h.substring(g.length,h.length);c=g;d=true;break}}if(!d){j.isPhoneValid=false;c=null;j.phoneNumber=e}}else{j.phoneNumber=h;c=(j.getCountryCode()==null||j.getCountryCode()=="")?"1":j.getCountryCode();j.setPhoneNumber(j.dropdown.getValue(),h)}};a.getTextField=function(){return a.phoneField};a.isPhoneEmpty=function(){return Ext.isEmpty(a.phoneField.getValue())};a.getPhoneNumber=function(){return a.stripSpecialCharacters(a.phoneField.getValue())};a.getCountryCode=function(){return a.dropdown.getValue()};a.checkAndSetPhoneNumber=function(c,d){c=a.stripSpecialCharacters(c);d=a.stripSpecialCharacters(d);if(!a.hideDropdown){if(Ext.isEmpty(c)){c="1"}a.parsePhoneNumber("+"+c+d)}else{if(c!="1"&&!Ext.isEmpty(c)){d="+"+c+d;c=null;a.phoneField.setValue(d)}else{a.phoneField.setValue(a.formatPhoneNumber(c,d))}}a.checkPhoneValidity(c,d)};Ext.apply(a.phoneField,a.inputConfig);a.callParent(arguments)}});